# Network UPS Tools: upsmon.conf

# Monitorear el UPS local
# Formato: MONITOR <ups> <powervalue> <user> <password> <type>
# powervalue = 1 (este sistema depende de este UPS)
# type = primary (este sistema controla el UPS)
MONITOR cyberpower@localhost 1 upsmon upsmonpass123 primary

# Número de sockets/conexiones que upsd permite
MINSUPPLIES 1

# Comando para apagar el sistema
SHUTDOWNCMD "/usr/bin/systemctl poweroff"

# Segundos entre chequeos de conectividad
POLLFREQ 5

# Segundos entre chequeos cuando hay problema
POLLFREQALERT 5

# Segundos sin contacto antes de declarar UPS muerto
HOSTSYNC 15

# Segundos para esperar por upsd en shutdown
DEADTIME 15

# Ruta para socket de comunicación
POWERDOWNFLAG /etc/nut/killpower

# Scripts de notificación - upssched maneja eventos temporizados
NOTIFYCMD /usr/sbin/upssched

# Configurar notificaciones
NOTIFYMSG ONLINE    "UPS %s conectado a la corriente"
NOTIFYMSG ONBATT    "UPS %s funcionando con batería"
NOTIFYMSG LOWBATT   "UPS %s batería baja"
NOTIFYMSG FSD       "UPS %s apagado forzado en progreso"
NOTIFYMSG COMMOK    "Comunicación con UPS %s establecida"
NOTIFYMSG COMMBAD   "Comunicación con UPS %s perdida"
NOTIFYMSG SHUTDOWN  "Apagado automático en progreso"
NOTIFYMSG REPLBATT  "UPS %s batería necesita reemplazo"
NOTIFYMSG NOCOMM    "UPS %s no disponible"
NOTIFYMSG NOPARENT  "upsmon padre proceso murió - apagando"

# Tipos de notificación (SYSLOG + EXEC = log + ejecutar upssched)
NOTIFYFLAG ONLINE   SYSLOG+EXEC
NOTIFYFLAG ONBATT   SYSLOG+EXEC
NOTIFYFLAG LOWBATT  SYSLOG+EXEC
NOTIFYFLAG FSD      SYSLOG+EXEC
NOTIFYFLAG COMMOK   SYSLOG+EXEC
NOTIFYFLAG COMMBAD  SYSLOG+EXEC
NOTIFYFLAG SHUTDOWN SYSLOG+EXEC
NOTIFYFLAG REPLBATT SYSLOG+EXEC
NOTIFYFLAG NOCOMM   SYSLOG+EXEC
NOTIFYFLAG NOPARENT SYSLOG+EXEC

# Deshabilitar broadcasts para suspend/resume (solo syslog, sin WALL)
NOTIFYFLAG SUSPEND_STARTING  SYSLOG
NOTIFYFLAG SUSPEND_FINISHED  SYSLOG

# Intervalo de polling final (segundos) antes de shutdown
FINALDELAY 5

# Usuario para ejecutar upsmon (debe tener permisos para shutdown)
RUN_AS_USER root
